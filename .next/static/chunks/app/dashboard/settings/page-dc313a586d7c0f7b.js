(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[631],{283:(e,r,a)=>{"use strict";a.d(r,{A:()=>c,O:()=>n});var s=a(5155),t=a(2115),o=a(5695),l=a(2409);let i=(0,t.createContext)(void 0);function n(e){let{children:r}=e,[a,n]=(0,t.useState)(null),[c,d]=(0,t.useState)(null),[m,u]=(0,t.useState)(null),[h,g]=(0,t.useState)(!0),f=(0,o.useRouter)();(0,t.useEffect)(()=>{let e=setTimeout(()=>{console.log("AuthProvider: Fallback timer - setting loading to false without error"),g(!1)},15e3);return()=>clearTimeout(e)},[]),(0,t.useEffect)(()=>{let e=!1;console.log("AuthProvider useEffect running"),async function(){var r;g(!0),console.log("Calling supabase.auth.getSession()");let{data:{session:a}}=await l.N.auth.getSession();if(console.log("supabase.auth.getSession() result:",a),!e){if(n(null!=(r=null==a?void 0:a.user)?r:null),null==a?void 0:a.user){let e=x(a.user.id),r=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,r])}g(!1),console.log("AuthProvider setLoading(false) after loadSession")}}();let{data:{subscription:r}}=l.N.auth.onAuthStateChange(async(r,a)=>{var s;if(!e){if(console.log("onAuthStateChange event:",r,"session:",a),n(null!=(s=null==a?void 0:a.user)?s:null),null==a?void 0:a.user){let e=x(a.user.id),r=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,r])}else d(null),u(null),"/login"!==window.location.pathname&&f.push("/login");g(!1),console.log("AuthProvider setLoading(false) after onAuthStateChange")}});return()=>{e=!0,r.unsubscribe()}},[f]);let x=async e=>{console.log("fetchProfile called with userId:",e);try{console.log("Making Supabase query for profile...");let{data:a,error:s}=await l.N.from("profiles").select("*").eq("id",e).single();if(console.log("Supabase query completed. Data:",a,"Error:",s),s){if(console.error("fetchProfile error:",s),"PGRST116"===s.code){console.log("No profile found, creating new profile...");let{data:a}=await l.N.auth.getUser();if(null==a?void 0:a.user){var r;console.log("Creating profile for user:",a.user.email);let{data:s,error:t}=await l.N.from("profiles").insert({id:e,email:a.user.email||"",full_name:(null==(r=a.user.user_metadata)?void 0:r.full_name)||null,role:"user",is_active:!0}).select().single();if(console.log("Profile creation result:",s,"Error:",t),t){console.error("Error creating profile:",t),d(null),u(null);return}console.log("New profile created:",s),d(s),u(null)}}else console.log("Profile error is not PGRST116, setting profile to null"),d(null),u(null);return}if(console.log("fetchProfile result:",a),d(a),null==a?void 0:a.organization_id){console.log("Fetching organization data for ID:",a.organization_id);let{data:e,error:r}=await l.N.from("organizations").select("*").eq("id",a.organization_id).single();console.log("Organization query result:",e,"Error:",r),r?(console.error("fetchProfile organization error:",r),u(null)):(console.log("fetchProfile organization result:",e),u(e))}else console.log("No organization_id found, setting organization to null"),u(null)}catch(e){console.error("Unexpected error in fetchProfile:",e),d(null),u(null)}},p=async()=>{await l.N.auth.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"};return(0,s.jsx)(i.Provider,{value:{user:a,profile:c,organization:m,loading:h,signOut:p},children:h?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-t-2",style:{borderColor:"#595F39"}})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading ScaleWize AI"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Connecting to your workspace..."})]})}):r})}function c(){let e=(0,t.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},646:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1154:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2409:(e,r,a)=>{"use strict";a.d(r,{N:()=>s});let s=(0,a(3254).createBrowserClient)("https://mtybaactacapokejmtxy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJhYWN0YWNhcG9rZWptdHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTE5MTMsImV4cCI6MjA2NzI4NzkxM30.u9EudibnPY-rGAFX4E2TfCgyKEBa9_7a2nojUcICJGQ")},2919:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(9946).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},4499:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>x});var s=a(5155),t=a(2115),o=a(283),l=a(6313),i=a(2409),n=a(1154),c=a(646),d=a(5339),m=a(9946);let u=(0,m.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var h=a(2919);let g=(0,m.A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var f=a(8883);function x(){let{profile:e,organization:r}=(0,o.A)(),[a,m]=(0,t.useState)({fullName:"",email:"",currentPassword:"",newPassword:"",confirmPassword:""}),[x,p]=(0,t.useState)(!1),[w,y]=(0,t.useState)(""),[b,N]=(0,t.useState)(""),[j,v]=(0,t.useState)("profile");(0,t.useEffect)(()=>{e&&m(r=>({...r,fullName:e.full_name||"",email:e.email||""}))},[e]);let E=async r=>{r.preventDefault(),p(!0),y(""),N("");try{let{error:r}=await i.N.from("profiles").update({full_name:a.fullName,updated_at:new Date().toISOString()}).eq("id",null==e?void 0:e.id);if(r)throw Error(r.message);N("Profile updated successfully!"),p(!1),setTimeout(()=>N(""),3e3)}catch(e){y(e instanceof Error?e.message:"An unexpected error occurred"),p(!1)}},P=async e=>{e.preventDefault(),p(!0),y(""),N("");try{await l.u.changeEmail(a.email),N("Email change request sent! Please check your email to confirm the change."),p(!1),setTimeout(()=>N(""),5e3)}catch(e){y(e instanceof Error?e.message:"An unexpected error occurred"),p(!1)}},A=async e=>{if(e.preventDefault(),p(!0),y(""),N(""),a.newPassword!==a.confirmPassword){y("New passwords do not match"),p(!1);return}if(a.newPassword.length<8){y("New password must be at least 8 characters long"),p(!1);return}try{await l.u.updatePassword(a.newPassword),N("Password updated successfully!"),p(!1),m(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""})),setTimeout(()=>N(""),3e3)}catch(e){y(e instanceof Error?e.message:"An unexpected error occurred"),p(!1)}};return e?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Account Settings"}),(0,s.jsx)("p",{className:"text-lg text-gray-600 mt-2",children:"Manage your profile information and security settings"})]}),b&&(0,s.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(c.A,{className:"h-5 w-5 mr-2"}),b]})}),w&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.A,{className:"h-5 w-5 mr-2"}),w]})}),(0,s.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,s.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,s.jsxs)("button",{onClick:()=>v("profile"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("profile"===j?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,s.jsx)(u,{className:"h-4 w-4 inline mr-2"}),"Profile"]}),(0,s.jsxs)("button",{onClick:()=>v("security"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("security"===j?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,s.jsx)(h.A,{className:"h-4 w-4 inline mr-2"}),"Security"]})]})}),"profile"===j&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)(u,{className:"h-6 w-6 mr-3",style:{color:"#595F39"}}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Profile Information"})]}),(0,s.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,s.jsx)("input",{id:"fullName",name:"fullName",type:"text",required:!0,value:a.fullName,onChange:e=>m(r=>({...r,fullName:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Enter your full name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,s.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:a.email,onChange:e=>m(r=>({...r,email:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Enter your email"})]})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)("button",{type:"submit",disabled:x,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",style:{backgroundColor:"#595F39"},children:[x?(0,s.jsx)(n.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(g,{className:"h-4 w-4 mr-2"}),"Update Profile"]})})]}),r&&(0,s.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Organization"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Name"}),(0,s.jsx)("p",{className:"text-base text-gray-900",children:r.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Your Role"}),(0,s.jsx)("p",{className:"text-base text-gray-900 capitalize",children:e.role})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Plan"}),(0,s.jsx)("p",{className:"text-base text-gray-900 capitalize",children:r.plan_type})]})]})]})]}),"security"===j&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)(h.A,{className:"h-6 w-6 mr-3",style:{color:"#595F39"}}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Security Settings"})]}),(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)(f.A,{className:"h-5 w-5 mr-2",style:{color:"#595F39"}}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Change Email Address"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Changing your email address will require confirmation via the new email."}),(0,s.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"newEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Email Address"}),(0,s.jsx)("input",{id:"newEmail",name:"newEmail",type:"email",required:!0,value:a.email,onChange:e=>m(r=>({...r,email:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Enter new email address"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)("button",{type:"submit",disabled:x,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",style:{backgroundColor:"#595F39"},children:[x?(0,s.jsx)(n.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Change Email"]})})]})]}),(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 mr-2",style:{color:"#595F39"}}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Change Password"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Your new password must be at least 8 characters long."}),(0,s.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,s.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",required:!0,value:a.newPassword,onChange:e=>m(r=>({...r,newPassword:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Enter new password"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,s.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:a.confirmPassword,onChange:e=>m(r=>({...r,confirmPassword:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Confirm new password"})]})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)("button",{type:"submit",disabled:x,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",style:{backgroundColor:"#595F39"},children:[x?(0,s.jsx)(n.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Change Password"]})})]})]})]})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(n.A,{className:"h-16 w-16 animate-spin mx-auto mb-4",style:{color:"#595F39"}}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Loading..."}),(0,s.jsx)("p",{className:"text-gray-600",children:"Please wait while we load your profile."})]})})}},5339:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5695:(e,r,a)=>{"use strict";var s=a(8999);a.o(s,"useRouter")&&a.d(r,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(r,{useSearchParams:function(){return s.useSearchParams}})},6110:(e,r,a)=>{Promise.resolve().then(a.bind(a,4499))},6313:(e,r,a)=>{"use strict";a.d(r,{u:()=>t});var s=a(2409);class t{static async signup(e){try{let{data:r,error:a}=await s.N.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.fullName,organization_name:e.organizationName,organization_slug:e.organizationSlug}}});if(a)throw Error(a.message);if(!r.user)throw Error("Failed to create user account");let{data:t,error:o}=await s.N.from("organizations").insert({name:e.organizationName,domain:e.organizationSlug,subscription_status:"trial",plan_type:"starter",max_users:50,max_chat_sessions:1e3,monthly_token_limit:1e5,librechat_config:{}}).select().single();if(o)throw Error("Failed to create organization: ".concat(o.message));let{data:l,error:i}=await s.N.from("profiles").insert({id:r.user.id,email:e.email,full_name:e.fullName,organization_id:t.id,role:"admin",is_active:!0}).select().single();if(i)throw Error("Failed to create user profile: ".concat(i.message));return{user:r.user,organization:t,profile:l}}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async inviteUser(e){try{let r=await fetch("/api/auth/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,fullName:e.fullName,role:e.role,organizationId:e.organizationId})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"Failed to send invite")}}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async sendMagicLink(e,r){try{let a="".concat(window.location.origin,"/auth/callback"),t=r?"?".concat(new URLSearchParams(r).toString()):"",{error:o}=await s.N.auth.signInWithOtp({email:e,options:{emailRedirectTo:"".concat(a).concat(t)}});if(o)throw Error(o.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async resetPassword(e){try{let{error:r}=await s.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(r)throw Error(r.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async updatePassword(e){try{let{error:r}=await s.N.auth.updateUser({password:e});if(r)throw Error(r.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async changeEmail(e){try{let{error:r}=await s.N.auth.updateUser({email:e});if(r)throw Error(r.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async reauthenticate(e){try{let{data:{user:e}}=await s.N.auth.getUser();if(!e)throw Error("No authenticated user found");let{data:{session:r}}=await s.N.auth.getSession();if(!r)throw Error("User session expired")}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async getCurrentUserData(){try{let{data:{user:e}}=await s.N.auth.getUser();if(!e)return{profile:null,organization:null};let{data:r,error:a}=await s.N.from("profiles").select("*").eq("id",e.id).single();if(a)throw Error("Failed to fetch profile: ".concat(a.message));let t=null;if(r.organization_id){let{data:e,error:a}=await s.N.from("organizations").select("*").eq("id",r.organization_id).single();a?console.error("Failed to fetch organization:",a):t=e}return{profile:r,organization:t}}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async signOut(){try{let{error:e}=await s.N.auth.signOut();if(e)throw Error(e.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}}},8883:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(9946).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])}},e=>{var r=r=>e(e.s=r);e.O(0,[691,441,684,358],()=>r(6110)),_N_E=e.O()}]);