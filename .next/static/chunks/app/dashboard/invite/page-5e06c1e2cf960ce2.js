(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[251],{283:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,O:()=>n});var a=t(5155),s=t(2115),o=t(5695),i=t(2409);let l=(0,s.createContext)(void 0);function n(e){let{children:r}=e,[t,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0),f=(0,o.useRouter)();(0,s.useEffect)(()=>{let e=setTimeout(()=>{console.log("AuthProvider: Fallback timer - setting loading to false without error"),g(!1)},15e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{let e=!1;console.log("AuthProvider useEffect running"),async function(){var r;g(!0),console.log("Calling supabase.auth.getSession()");let{data:{session:t}}=await i.N.auth.getSession();if(console.log("supabase.auth.getSession() result:",t),!e){if(n(null!=(r=null==t?void 0:t.user)?r:null),null==t?void 0:t.user){let e=x(t.user.id),r=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,r])}g(!1),console.log("AuthProvider setLoading(false) after loadSession")}}();let{data:{subscription:r}}=i.N.auth.onAuthStateChange(async(r,t)=>{var a;if(!e){if(console.log("onAuthStateChange event:",r,"session:",t),n(null!=(a=null==t?void 0:t.user)?a:null),null==t?void 0:t.user){let e=x(t.user.id),r=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,r])}else d(null),m(null),"/login"!==window.location.pathname&&f.push("/login");g(!1),console.log("AuthProvider setLoading(false) after onAuthStateChange")}});return()=>{e=!0,r.unsubscribe()}},[f]);let x=async e=>{console.log("fetchProfile called with userId:",e);try{console.log("Making Supabase query for profile...");let{data:t,error:a}=await i.N.from("profiles").select("*").eq("id",e).single();if(console.log("Supabase query completed. Data:",t,"Error:",a),a){if(console.error("fetchProfile error:",a),"PGRST116"===a.code){console.log("No profile found, creating new profile...");let{data:t}=await i.N.auth.getUser();if(null==t?void 0:t.user){var r;console.log("Creating profile for user:",t.user.email);let{data:a,error:s}=await i.N.from("profiles").insert({id:e,email:t.user.email||"",full_name:(null==(r=t.user.user_metadata)?void 0:r.full_name)||null,role:"user",is_active:!0}).select().single();if(console.log("Profile creation result:",a,"Error:",s),s){console.error("Error creating profile:",s),d(null),m(null);return}console.log("New profile created:",a),d(a),m(null)}}else console.log("Profile error is not PGRST116, setting profile to null"),d(null),m(null);return}if(console.log("fetchProfile result:",t),d(t),null==t?void 0:t.organization_id){console.log("Fetching organization data for ID:",t.organization_id);let{data:e,error:r}=await i.N.from("organizations").select("*").eq("id",t.organization_id).single();console.log("Organization query result:",e,"Error:",r),r?(console.error("fetchProfile organization error:",r),m(null)):(console.log("fetchProfile organization result:",e),m(e))}else console.log("No organization_id found, setting organization to null"),m(null)}catch(e){console.error("Unexpected error in fetchProfile:",e),d(null),m(null)}},p=async()=>{await i.N.auth.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"};return(0,a.jsx)(l.Provider,{value:{user:t,profile:c,organization:u,loading:h,signOut:p},children:h?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-t-2",style:{borderColor:"#595F39"}})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading ScaleWize AI"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Connecting to your workspace..."})]})}):r})}function c(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},646:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},809:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var a=t(5155),s=t(2115),o=t(283),i=t(6313),l=t(5339),n=t(646),c=t(3227),d=t(2318),u=t(1154);function m(){let{profile:e,organization:r}=(0,o.A)(),[t,m]=(0,s.useState)({email:"",fullName:"",role:"user"}),[h,g]=(0,s.useState)(!1),[f,x]=(0,s.useState)(""),[p,y]=(0,s.useState)(!1);if(!e||!r||"admin"!==e.role&&"super_admin"!==e.role)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,a.jsx)(l.A,{className:"h-16 w-16 text-red-600 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600",children:"You don't have permission to invite users to this organization."})]})});let w=async e=>{e.preventDefault(),g(!0),x(""),y(!1);try{await i.u.inviteUser({email:t.email,fullName:t.fullName,role:t.role,organizationId:r.id}),y(!0),g(!1),setTimeout(()=>{y(!1),m({email:"",fullName:"",role:"user"})},3e3)}catch(e){x(e instanceof Error?e.message:"An unexpected error occurred"),g(!1)}};return p?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(n.A,{className:"h-16 w-16 text-green-600"})}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Invitation Sent!"}),(0,a.jsxs)("p",{className:"text-lg text-gray-600",children:["We've sent an invitation to ",(0,a.jsx)("strong",{children:t.email})," to join ",r.name,"."]}),(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-sm text-green-800",children:"The user will receive an email with instructions to join your organization."})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 mr-3",style:{color:"#595F39"}}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Invite Team Members"})]}),(0,a.jsxs)("p",{className:"text-lg text-gray-600",children:["Invite new users to join ",(0,a.jsx)("strong",{children:r.name})," and collaborate on your AI automation projects."]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(d.A,{className:"h-6 w-6 mr-3",style:{color:"#595F39"}}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Send Invitation"})]}),(0,a.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,a.jsx)("input",{id:"fullName",name:"fullName",type:"text",required:!0,value:t.fullName,onChange:e=>m(r=>({...r,fullName:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Enter full name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:t.email,onChange:e=>m(r=>({...r,email:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},placeholder:"Enter email address"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,a.jsxs)("select",{id:"role",name:"role",value:t.role,onChange:e=>m(r=>({...r,role:e.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},children:[(0,a.jsx)("option",{value:"user",children:"User"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"admin"===t.role?"Admins can manage users, settings, and billing for the organization.":"Users can access organization resources and collaborate on projects."})]}),f&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm",children:f}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>m({email:"",fullName:"",role:"user"}),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-0",style:{"--tw-ring-color":"#595F39"},children:"Clear Form"}),(0,a.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-2 border border-transparent rounded-md text-sm font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",style:{backgroundColor:"#595F39"},children:h?(0,a.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):"Send Invitation"})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Organization Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Organization Name"}),(0,a.jsx)("p",{className:"text-base text-gray-900",children:r.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Current Plan"}),(0,a.jsx)("p",{className:"text-base text-gray-900 capitalize",children:r.plan_type})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Max Users"}),(0,a.jsx)("p",{className:"text-base text-gray-900",children:r.max_users})]})]})]})]})})}},1154:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2318:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},2409:(e,r,t)=>{"use strict";t.d(r,{N:()=>a});let a=(0,t(3254).createBrowserClient)("https://mtybaactacapokejmtxy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJhYWN0YWNhcG9rZWptdHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTE5MTMsImV4cCI6MjA2NzI4NzkxM30.u9EudibnPY-rGAFX4E2TfCgyKEBa9_7a2nojUcICJGQ")},3227:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},5339:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},6313:(e,r,t)=>{"use strict";t.d(r,{u:()=>s});var a=t(2409);class s{static async signup(e){try{let{data:r,error:t}=await a.N.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.fullName,organization_name:e.organizationName,organization_slug:e.organizationSlug}}});if(t)throw Error(t.message);if(!r.user)throw Error("Failed to create user account");let{data:s,error:o}=await a.N.from("organizations").insert({name:e.organizationName,domain:e.organizationSlug,subscription_status:"trial",plan_type:"starter",max_users:50,max_chat_sessions:1e3,monthly_token_limit:1e5,librechat_config:{}}).select().single();if(o)throw Error("Failed to create organization: ".concat(o.message));let{data:i,error:l}=await a.N.from("profiles").insert({id:r.user.id,email:e.email,full_name:e.fullName,organization_id:s.id,role:"admin",is_active:!0}).select().single();if(l)throw Error("Failed to create user profile: ".concat(l.message));return{user:r.user,organization:s,profile:i}}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async inviteUser(e){try{let r=await fetch("/api/auth/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,fullName:e.fullName,role:e.role,organizationId:e.organizationId})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"Failed to send invite")}}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async sendMagicLink(e,r){try{let t="".concat(window.location.origin,"/auth/callback"),s=r?"?".concat(new URLSearchParams(r).toString()):"",{error:o}=await a.N.auth.signInWithOtp({email:e,options:{emailRedirectTo:"".concat(t).concat(s)}});if(o)throw Error(o.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async resetPassword(e){try{let{error:r}=await a.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(r)throw Error(r.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async updatePassword(e){try{let{error:r}=await a.N.auth.updateUser({password:e});if(r)throw Error(r.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async changeEmail(e){try{let{error:r}=await a.N.auth.updateUser({email:e});if(r)throw Error(r.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async reauthenticate(e){try{let{data:{user:e}}=await a.N.auth.getUser();if(!e)throw Error("No authenticated user found");let{data:{session:r}}=await a.N.auth.getSession();if(!r)throw Error("User session expired")}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async getCurrentUserData(){try{let{data:{user:e}}=await a.N.auth.getUser();if(!e)return{profile:null,organization:null};let{data:r,error:t}=await a.N.from("profiles").select("*").eq("id",e.id).single();if(t)throw Error("Failed to fetch profile: ".concat(t.message));let s=null;if(r.organization_id){let{data:e,error:t}=await a.N.from("organizations").select("*").eq("id",r.organization_id).single();t?console.error("Failed to fetch organization:",t):s=e}return{profile:r,organization:s}}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}static async signOut(){try{let{error:e}=await a.N.auth.signOut();if(e)throw Error(e.message)}catch(e){throw Error(e instanceof Error?e.message:"An unexpected error occurred")}}}},9694:(e,r,t)=>{Promise.resolve().then(t.bind(t,809))}},e=>{var r=r=>e(e.s=r);e.O(0,[691,441,684,358],()=>r(9694)),_N_E=e.O()}]);