(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[969],{283:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,O:()=>o});var l=s(5155),r=s(2115),a=s(5695),i=s(2409);let n=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(null),[m,f]=(0,r.useState)(!0),g=(0,a.useRouter)();(0,r.useEffect)(()=>{let e=setTimeout(()=>{console.log("AuthProvider: Fallback timer - setting loading to false without error"),f(!1)},15e3);return()=>clearTimeout(e)},[]),(0,r.useEffect)(()=>{let e=!1;console.log("AuthProvider useEffect running"),async function(){var t;f(!0),console.log("Calling supabase.auth.getSession()");let{data:{session:s}}=await i.N.auth.getSession();if(console.log("supabase.auth.getSession() result:",s),!e){if(o(null!=(t=null==s?void 0:s.user)?t:null),null==s?void 0:s.user){let e=x(s.user.id),t=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,t])}f(!1),console.log("AuthProvider setLoading(false) after loadSession")}}();let{data:{subscription:t}}=i.N.auth.onAuthStateChange(async(t,s)=>{var l;if(!e){if(console.log("onAuthStateChange event:",t,"session:",s),o(null!=(l=null==s?void 0:s.user)?l:null),null==s?void 0:s.user){let e=x(s.user.id),t=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,t])}else u(null),h(null),"/login"!==window.location.pathname&&g.push("/login");f(!1),console.log("AuthProvider setLoading(false) after onAuthStateChange")}});return()=>{e=!0,t.unsubscribe()}},[g]);let x=async e=>{console.log("fetchProfile called with userId:",e);try{console.log("Making Supabase query for profile...");let{data:s,error:l}=await i.N.from("profiles").select("*").eq("id",e).single();if(console.log("Supabase query completed. Data:",s,"Error:",l),l){if(console.error("fetchProfile error:",l),"PGRST116"===l.code){console.log("No profile found, creating new profile...");let{data:s}=await i.N.auth.getUser();if(null==s?void 0:s.user){var t;console.log("Creating profile for user:",s.user.email);let{data:l,error:r}=await i.N.from("profiles").insert({id:e,email:s.user.email||"",full_name:(null==(t=s.user.user_metadata)?void 0:t.full_name)||null,role:"user",is_active:!0}).select().single();if(console.log("Profile creation result:",l,"Error:",r),r){console.error("Error creating profile:",r),u(null),h(null);return}console.log("New profile created:",l),u(l),h(null)}}else console.log("Profile error is not PGRST116, setting profile to null"),u(null),h(null);return}if(console.log("fetchProfile result:",s),u(s),null==s?void 0:s.organization_id){console.log("Fetching organization data for ID:",s.organization_id);let{data:e,error:t}=await i.N.from("organizations").select("*").eq("id",s.organization_id).single();console.log("Organization query result:",e,"Error:",t),t?(console.error("fetchProfile organization error:",t),h(null)):(console.log("fetchProfile organization result:",e),h(e))}else console.log("No organization_id found, setting organization to null"),h(null)}catch(e){console.error("Unexpected error in fetchProfile:",e),u(null),h(null)}},p=async()=>{await i.N.auth.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"};return(0,l.jsx)(n.Provider,{value:{user:s,profile:c,organization:d,loading:m,signOut:p},children:m?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-t-2",style:{borderColor:"#595F39"}})}),(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading ScaleWize AI"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Connecting to your workspace..."})]})}):t})}function c(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},798:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var l=s(5155),r=s(2115),a=s(283),i=s(1497);(0,s(9946).A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var n=s(7580),o=s(1154),c=s(2409);function u(){let{user:e,organization:t}=(0,a.A)(),[s,u]=(0,r.useState)(""),[d,h]=(0,r.useState)(!0),[m,f]=(0,r.useState)("");return(0,r.useEffect)(()=>{(async()=>{if(!e||!t)return h(!1);try{h(!0);let{data:{session:e}}=await c.N.auth.getSession(),t=null==e?void 0:e.access_token,s="https://scalewize-production-chatbot-production.up.railway.app",l=await fetch("".concat(s,"/api/auth/sso/librechat"),{method:"POST",credentials:"include",headers:t?{Authorization:"Bearer ".concat(t)}:{}});if(!l.ok)throw Error("Failed to get LibreChat session");let{libreSession:r}=await l.json();u(s.replace("http://","https://"))}catch(e){f("Failed to connect to chat service")}finally{h(!1)}})()},[e,t]),i.A,i.A,n.A,console.log("user:",e),console.log("organization:",t),console.log("libreChatUrl:",s),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Chat Interface"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Powered by ScaleWize AI - Connected to your business systems and databases"})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Connected"})})]})}),(0,l.jsx)("div",{className:"h-[600px]",children:d?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(o.A,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Connecting to chat service..."})]})}):m?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-red-600 mb-4",children:m}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry Connection"})]})}):s?(0,l.jsx)("iframe",{src:"".concat(s),className:"w-full h-full rounded-b-lg",title:"ScaleWize AI Chatbot",frameBorder:"0"}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("p",{className:"text-gray-600",children:"Unable to load chat interface"})})})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Configuration"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Connected Systems"}),(0,l.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[(0,l.jsxs)("li",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-2"}),"Customer Database"]}),(0,l.jsxs)("li",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-2"}),"CRM System"]}),(0,l.jsxs)("li",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"w-2 h-2 bg-yellow-400 rounded-full mr-2"}),"Knowledge Base"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Model Settings"}),(0,l.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[(0,l.jsx)("li",{children:"Primary Model: GPT-4"}),(0,l.jsx)("li",{children:"Fallback Model: GPT-3.5-turbo"}),(0,l.jsx)("li",{children:"Max Tokens: 4,096"}),(0,l.jsx)("li",{children:"Temperature: 0.7"})]})]})]})]})]})}},1154:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1497:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},2409:(e,t,s)=>{"use strict";s.d(t,{N:()=>l});let l=(0,s(3254).createBrowserClient)("https://mtybaactacapokejmtxy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJhYWN0YWNhcG9rZWptdHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTE5MTMsImV4cCI6MjA2NzI4NzkxM30.u9EudibnPY-rGAFX4E2TfCgyKEBa9_7a2nojUcICJGQ")},5695:(e,t,s)=>{"use strict";var l=s(8999);s.o(l,"useRouter")&&s.d(t,{useRouter:function(){return l.useRouter}}),s.o(l,"useSearchParams")&&s.d(t,{useSearchParams:function(){return l.useSearchParams}})},6281:(e,t,s)=>{Promise.resolve().then(s.bind(s,798))},7580:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[691,441,684,358],()=>t(6281)),_N_E=e.O()}]);