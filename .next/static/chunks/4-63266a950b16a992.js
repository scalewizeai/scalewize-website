"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4],{283:(e,t,r)=>{r.d(t,{A:()=>c,O:()=>i});var n=r(5155),a=r(2115),s=r(5695),o=r(2409);let l=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,g]=(0,a.useState)(null),[_,f]=(0,a.useState)(!0),h=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=setTimeout(()=>{console.log("AuthProvider: Fallback timer - setting loading to false without error"),f(!1)},15e3);return()=>clearTimeout(e)},[]),(0,a.useEffect)(()=>{let e=!1;console.log("AuthProvider useEffect running"),async function(){var t;f(!0),console.log("Calling supabase.auth.getSession()");let{data:{session:r}}=await o.N.auth.getSession();if(console.log("supabase.auth.getSession() result:",r),!e){if(i(null!=(t=null==r?void 0:r.user)?t:null),null==r?void 0:r.user){let e=m(r.user.id),t=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,t])}f(!1),console.log("AuthProvider setLoading(false) after loadSession")}}();let{data:{subscription:t}}=o.N.auth.onAuthStateChange(async(t,r)=>{var n;if(!e){if(console.log("onAuthStateChange event:",t,"session:",r),i(null!=(n=null==r?void 0:r.user)?n:null),null==r?void 0:r.user){let e=m(r.user.id),t=new Promise(e=>setTimeout(e,8e3));await Promise.race([e,t])}else d(null),g(null),"/login"!==window.location.pathname&&h.push("/login");f(!1),console.log("AuthProvider setLoading(false) after onAuthStateChange")}});return()=>{e=!0,t.unsubscribe()}},[h]);let m=async e=>{console.log("fetchProfile called with userId:",e);try{console.log("Making Supabase query for profile...");let{data:r,error:n}=await o.N.from("profiles").select("*").eq("id",e).single();if(console.log("Supabase query completed. Data:",r,"Error:",n),n){if(console.error("fetchProfile error:",n),"PGRST116"===n.code){console.log("No profile found, creating new profile...");let{data:r}=await o.N.auth.getUser();if(null==r?void 0:r.user){var t;console.log("Creating profile for user:",r.user.email);let{data:n,error:a}=await o.N.from("profiles").insert({id:e,email:r.user.email||"",full_name:(null==(t=r.user.user_metadata)?void 0:t.full_name)||null,role:"user",is_active:!0}).select().single();if(console.log("Profile creation result:",n,"Error:",a),a){console.error("Error creating profile:",a),d(null),g(null);return}console.log("New profile created:",n),d(n),g(null)}}else console.log("Profile error is not PGRST116, setting profile to null"),d(null),g(null);return}if(console.log("fetchProfile result:",r),d(r),null==r?void 0:r.organization_id){console.log("Fetching organization data for ID:",r.organization_id);let{data:e,error:t}=await o.N.from("organizations").select("*").eq("id",r.organization_id).single();console.log("Organization query result:",e,"Error:",t),t?(console.error("fetchProfile organization error:",t),g(null)):(console.log("fetchProfile organization result:",e),g(e))}else console.log("No organization_id found, setting organization to null"),g(null)}catch(e){console.error("Unexpected error in fetchProfile:",e),d(null),g(null)}},p=async()=>{await o.N.auth.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"};return(0,n.jsx)(l.Provider,{value:{user:r,profile:c,organization:u,loading:_,signOut:p},children:_?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-t-2",style:{borderColor:"#595F39"}})}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading ScaleWize AI"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Connecting to your workspace..."})]})}):t})}function c(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1497:(e,t,r)=>{r.d(t,{A:()=>n});let n=(0,r(9946).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},2409:(e,t,r)=>{r.d(t,{N:()=>n});let n=(0,r(3254).createBrowserClient)("https://mtybaactacapokejmtxy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJhYWN0YWNhcG9rZWptdHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTE5MTMsImV4cCI6MjA2NzI4NzkxM30.u9EudibnPY-rGAFX4E2TfCgyKEBa9_7a2nojUcICJGQ")},3109:(e,t,r)=>{r.d(t,{A:()=>n});let n=(0,r(9946).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},5695:(e,t,r)=>{var n=r(8999);r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7580:(e,t,r)=>{r.d(t,{A:()=>n});let n=(0,r(9946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},7913:(e,t,r)=>{r.d(t,{K:()=>s});var n=r(2409);class a{async getAnalytics(){try{let{data:e,error:t}=await n.N.rpc("get_linkedin_analytics",{org_id:this.organizationId});if(t)return console.error("Error fetching LinkedIn analytics:",t),null;return e}catch(e){return console.error("Error in getAnalytics:",e),null}}async getLeads(e){try{let t=n.N.from("leads").select("*").eq("organization_id",this.organizationId).not("linkedin_url","is",null).order("created_at",{ascending:!1});e&&"all"!==e&&(t=t.eq("status",e));let{data:r,error:a}=await t;if(a)return console.error("Error fetching LinkedIn leads:",a),[];return r||[]}catch(e){return console.error("Error in getLeads:",e),[]}}async getLeadMessages(e){try{let{data:t,error:r}=await n.N.from("messages").select("*").or("sender_linkedin_url.eq.".concat(e,",recipient_linkedin_url.eq.").concat(e)).in("message_type",["connection_request","first_message","response"]).order("message_date",{ascending:!0});if(r)return console.error("Error fetching lead messages:",r),[];return t||[]}catch(e){return console.error("Error in getLeadMessages:",e),[]}}async addLead(e){try{let{data:t,error:r}=await n.N.from("leads").insert({...e,organization_id:this.organizationId,status:"PENDING"}).select().single();if(r)return console.error("Error adding LinkedIn lead:",r),null;return t}catch(e){return console.error("Error in addLead:",e),null}}async updateLeadStatus(e,t){try{let{error:r}=await n.N.from("leads").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).eq("organization_id",this.organizationId);if(r)return console.error("Error updating lead status:",r),!1;return!0}catch(e){return console.error("Error in updateLeadStatus:",e),!1}}async addMessage(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{let s={organization_id:this.organizationId,message_type:t,content:r,message_date:new Date().toISOString()};a?(s.sender_linkedin_url=e,s.recipient_linkedin_url=null):(s.sender_linkedin_url=null,s.recipient_linkedin_url=e);let{error:o}=await n.N.from("messages").insert(s);if(o)return console.error("Error adding LinkedIn message:",o),!1;return!0}catch(e){return console.error("Error in addMessage:",e),!1}}async getDailyMetrics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{let t=new Date,r=new Date;r.setDate(r.getDate()-e);let{data:a,error:s}=await n.N.from("leads").select("created_at").eq("organization_id",this.organizationId).not("linkedin_url","is",null).gte("created_at",r.toISOString()).lte("created_at",t.toISOString());if(s)return console.error("Error fetching leads for metrics:",s),[];let{data:o,error:l}=await n.N.from("messages").select("message_date, message_type").eq("organization_id",this.organizationId).in("message_type",["connection_request","first_message","response"]).gte("message_date",r.toISOString()).lte("message_date",t.toISOString());if(l)return console.error("Error fetching messages for metrics:",l),[];let i={};for(let t=0;t<e;t++){let e=new Date(r);e.setDate(e.getDate()+t),i[e.toISOString().split("T")[0]]={leads:0,messages:0,replies:0}}return null==a||a.forEach(e=>{let t=e.created_at.split("T")[0];i[t]&&i[t].leads++}),null==o||o.forEach(e=>{var t;let r=null==(t=e.message_date)?void 0:t.split("T")[0];r&&i[r]&&(i[r].messages++,"response"===e.message_type&&i[r].replies++)}),Object.entries(i).map(e=>{let[t,r]=e;return{date:t,...r}})}catch(e){return console.error("Error in getDailyMetrics:",e),[]}}async getLeadSources(){try{let{data:e,error:t}=await n.N.from("leads").select("company").eq("organization_id",this.organizationId).not("linkedin_url","is",null).not("company","is",null);if(t)return console.error("Error fetching lead sources:",t),[];let r={};null==e||e.forEach(e=>{e.company&&(r[e.company]=(r[e.company]||0)+1)});let a=Object.values(r).reduce((e,t)=>e+t,0);return Object.entries(r).map(e=>{let[t,r]=e;return{source:t,count:r,percentage:Math.round(r/a*100)}}).sort((e,t)=>t.count-e.count).slice(0,10)}catch(e){return console.error("Error in getLeadSources:",e),[]}}async getDetailedMetrics(){try{let e=await this.getAnalytics();if(!e)return null;let t=e.total_leads;e.connected_leads,e.responded_leads,e.booked_leads,t>0&&e.closed_leads;let r=await this.getLeads(),n=0,a=0;r.forEach(e=>{if(e.connection_request_sent_at&&e.last_contact_at&&"RESPONDED"===e.status){let t=new Date(e.connection_request_sent_at).getTime(),r=new Date(e.last_contact_at).getTime();n+=r-t,a++}});let s=a>0?Math.round(n/a/864e5):0,o=5e3*r.filter(e=>["CONNECTED","RESPONDED","ACTIVE","BOOKED"].includes(e.status)).length,l={};r.forEach(e=>{e.company&&(l[e.company]||(l[e.company]={leads:0,closed:0}),l[e.company].leads++,"CLOSED"===e.status&&l[e.company].closed++)});let i=Object.entries(l).map(e=>{let[t,r]=e;return{company:t,leads:r.leads,conversionRate:r.leads>0?Math.round(r.closed/r.leads*100):0}}).sort((e,t)=>t.conversionRate-e.conversionRate).slice(0,5),c=[];for(let e=3;e>=0;e--){let t=new Date;t.setDate(t.getDate()-7*e);let n=new Date(t);n.setDate(n.getDate()+6);let a=r.filter(e=>{let r=new Date(e.created_at);return r>=t&&r<=n}).length,s=r.filter(e=>{if(!e.last_contact_at)return!1;let r=new Date(e.last_contact_at);return r>=t&&r<=n&&"RESPONDED"===e.status}).length;r.filter(e=>{if(!e.last_contact_at)return!1;let r=new Date(e.last_contact_at);return r>=t&&r<=n&&"CLOSED"===e.status}).length,c.push({week:t.toLocaleDateString("en-US",{month:"short",day:"numeric"}),leads:a,responses:s,connections:a})}let d={};r.forEach(e=>{d[e.status]=(d[e.status]||0)+1});let u=e.connection_requests_sent||0,g=e.connected_leads||0,_=e.responses_received||0,f=e.responded_leads+e.booked_leads||0,h=t>0?Math.round(g/t*100):0,m=t>0?Math.round((e.responded_leads+e.booked_leads+e.closed_leads)/t*100):0,p=t>0?Math.round(f/t*100):0,y=0,w=0;r.forEach(e=>{if(e.connection_request_sent_at&&e.first_message_sent_at){let t=new Date(e.connection_request_sent_at).getTime(),r=new Date(e.first_message_sent_at).getTime();y+=r-t,w++}});let E=w>0?Math.round(y/w/864e5):0,k=e.total_messages||0,S=e.connection_requests_sent+e.first_messages_sent||0,D=e.responses_received||0,N=t>0?Math.round(k/t*10)/10:0;return{totalLeads:t,connectionRequestsSent:u,connectionsMade:g,responses:_,activeConversations:f,connectionRate:h,responseRate:m,activeConversationRate:p,avgTimeToResponse:s,avgTimeToConnection:E,pipelineValue:o,statusBreakdown:d,topPerformingCompanies:i,weeklyTrends:c,totalMessages:k,messagesSent:S,messagesReceived:D,avgMessagesPerLead:N}}catch(e){return console.error("Error in getExecutiveMetrics:",e),null}}async getWeeklyMessageData(){try{let{data:e,error:t}=await n.N.rpc("get_weekly_linkedin_analytics",{org_id:this.organizationId,weeks_back:8});if(t)throw console.error("Supabase RPC error:",t),t;return e||[]}catch(e){throw console.error("Error in getWeeklyMessageData:",e),e}}async getDashboardMetrics(){try{let e=await this.getAnalytics();if(!e)return null;let t=e.total_leads,r=e.connected_leads+e.responded_leads+e.booked_leads,n=t>0?Math.round(e.closed_leads/t*100):0;return{totalLeads:t,activeLeads:r,conversionRate:n}}catch(e){return console.error("Error in getDashboardMetrics:",e),null}}async updateAllLeadStatuses(){try{let[r,a]=await Promise.all([this.getLeads(),n.N.from("messages").select("*").eq("organization_id",this.organizationId).in("message_type",["connection_request","first_message","response"]).then(e=>{let{data:t,error:r}=e;if(r)throw r;return t||[]})]),s=[],o={};for(let n of r){var e,t;let r=a.filter(e=>e.recipient_linkedin_url===n.linkedin_url||e.sender_linkedin_url===n.linkedin_url);if(0===r.length)continue;let l=n.status,i={};r.some(e=>e.recipient_linkedin_url===n.linkedin_url&&"first_message"===e.message_type)&&"SENT"===n.status&&(l="CONNECTED",i.first_message_sent_at=null==(e=r.filter(e=>e.recipient_linkedin_url===n.linkedin_url&&"first_message"===e.message_type).sort((e,t)=>new Date(e.message_date||"").getTime()-new Date(t.message_date||"").getTime())[0])?void 0:e.message_date);let c=r.filter(e=>e.sender_linkedin_url===n.linkedin_url&&"response"===e.message_type);c.length>0&&["SENT","CONNECTED"].includes(l)&&(l="RESPONDED"),c.length>1&&"RESPONDED"===l&&(l="ACTIVE");let d=r.filter(e=>e.recipient_linkedin_url===n.linkedin_url&&"connection_request"===e.message_type);d.length>0&&!n.connection_request_sent_at&&(i.connection_request_sent_at=null==(t=d.sort((e,t)=>new Date(e.message_date||"").getTime()-new Date(t.message_date||"").getTime())[0])?void 0:t.message_date);let u=r.sort((e,t)=>new Date(t.message_date||"").getTime()-new Date(e.message_date||"").getTime())[0];u&&(i.last_contact_at=u.message_date),(l!==n.status||Object.keys(i).length>0)&&s.push({id:n.id,status:l,...i,updated_at:new Date().toISOString()}),o[l]=(o[l]||0)+1}if(s.length>0){let{error:e}=await n.N.from("leads").upsert(s,{onConflict:"id"});if(e)return console.error("Error updating leads:",e),null}return{totalLeads:r.length,updatedLeads:s.length,statusDistribution:o}}catch(e){return console.error("Error in updateAllLeadStatuses:",e),null}}constructor(e){this.organizationId=e}}let s=e=>new a(e)}}]);